<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Tweets word-cloud | Christophe Website
</title>
  <link rel="canonical" href="https://tofguerrier.github.io/tweet_word_cloud.html">


  <link rel="stylesheet" href="https://tofguerrier.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://tofguerrier.github.io/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://tofguerrier.github.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://tofguerrier.github.io/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://tofguerrier.github.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://tofguerrier.github.io/feeds/{slug}.atom.xml">  
  <meta name="description" content="How to draw a word cloud with R, from twitter archive.">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-101316363-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://tofguerrier.github.io/">Christophe Website</a></h1>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://tofguerrier.github.io/pages/about-me.html">About me</a></li>
            <li class="list-inline-item"><a href="https://tofguerrier.github.io/pages/now.html">Now</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Tweets word-cloud
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2014-07-17T00:05:00+01:00">
          <i class="fa fa-clock-o"></i>
          Thu 17 July 2014
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="https://tofguerrier.github.io/category/data.html">Data</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-user-o"></i>
              <a href="https://tofguerrier.github.io/author/christophe.html">Christophe</a>          </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="https://tofguerrier.github.io/tag/r.html">#R</a>,               <a href="https://tofguerrier.github.io/tag/data-visualisation.html">#"data visualisation"</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>I have been interesting in looking at my own tweets, and see what kind of visualization and analyze I could run on it. First I used the archive feature on twitter to get a file copy of my tweets, then using the package wordcloud and tm I processed the archive.</p>
<h2>Getting a twitter snapshot</h2>
<p>There is way to query your twitter feed directly (using API and package like <a href="http://cran.r-project.org/web/packages/twitteR/index.html">twitterR</a>) , but the simplest way I found was to download an <a href="https://blog.twitter.com/2012/your-twitter-archive">archive</a>. 
The process is quite simple, go to your Twitter account settings, there should be a Request your archive link you can click on.</p>
<p>It will take some time to have your snapshot ready, but when it is, you will receive an email, follow the link and download it. You can can start exploring, by opening the index.html file. The archive is quite neat, you can explore by month and have an overview of your activity over the years.</p>
<p><img alt="Screen capture of my twitter archive" src="/images/wc_twitterarchive.png" title="twitter archive"></p>
<p>If you explore the directories unzipped the archive is composed of Json files, there is package to read those, but for my purpose I will use the csv file generated ( called tweets.csv), as I can read that straight away into R.</p>
<h2>R processing</h2>
<div class="highlight"><pre><span></span><span class="n">tweets</span><span class="o">=</span><span class="s">&quot;filepath/tweets.csv&quot;</span>
<span class="n">tw</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<p>Loading the packages I will use
tm is Text Mining Package.A framework for text mining applications within R.
wordcloud allow to generate word cloud pictures.</p>
<div class="highlight"><pre><span></span><span class="nf">require</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>
<span class="nf">require</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
</pre></div>


<p>From the text we create a corpus:</p>
<div class="highlight"><pre><span></span><span class="n">tw.corpus</span> <span class="o">&lt;-</span> <span class="nf">Corpus</span><span class="p">(</span><span class="nf">DataframeSource</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">tw</span><span class="o">$</span><span class="n">text</span><span class="p">)))</span>
</pre></div>


<p>Some cleaning up of the world, I will go into more detail in part 2.</p>
<div class="highlight"><pre><span></span><span class="n">tw.corpus</span> <span class="o">&lt;-</span> <span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> <span class="n">removePunctuation</span><span class="p">)</span>
<span class="n">tw.corpus</span> <span class="o">&lt;-</span> <span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> <span class="n">tolower</span><span class="p">)</span>
<span class="n">tw.corpus</span> <span class="o">&lt;-</span> <span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">removeWords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">stopwords</span><span class="p">(</span><span class="s">&quot;english&quot;</span><span class="p">)))</span>
<span class="n">tdm</span> <span class="o">&lt;-</span> <span class="nf">TermDocumentMatrix</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">)</span>
<span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">tdm</span><span class="p">)</span>
<span class="n">v</span> <span class="o">&lt;-</span> <span class="nf">sort</span><span class="p">(</span><span class="nf">rowSums</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">d</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">word</span> <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">freq</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
</pre></div>


<p>Already we can find the most frequent word, i use:</p>
<div class="highlight"><pre><span></span><span class="nf">max</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">freq</span><span class="p">)</span>
<span class="n">d</span><span class="nf">[which.max</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">freq</span><span class="p">),</span><span class="n">]</span><span class="o">$</span><span class="n">word</span>
</pre></div>


<p>Which is the word via, used 458 times.</p>
<div class="highlight"><pre><span></span><span class="nf">dim</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="n">[1]</span>
</pre></div>


<p>And find that I used 14619 different words.</p>
<p>Plotting the word cloud is straightforward from there:</p>
<div class="highlight"><pre><span></span><span class="nf">wordcloud</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">d</span><span class="o">$</span><span class="n">word</span><span class="p">,</span><span class="n">freq</span> <span class="o">=</span> <span class="n">d</span><span class="o">$</span><span class="n">freq</span><span class="p">,</span>
          <span class="n">scale</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">.3</span><span class="p">),</span>
          <span class="n">min.freq</span><span class="o">=</span><span class="m">10</span><span class="p">,</span>
          <span class="n">max.words</span><span class="o">=</span><span class="nf">dim</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="n">[1]</span><span class="p">,</span> <span class="n">random.order</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">rot.per</span><span class="o">=</span><span class="m">.15</span><span class="p">,</span> 
          <span class="n">vfont</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;sans serif&quot;</span><span class="p">,</span><span class="s">&quot;plain&quot;</span><span class="p">))</span>
</pre></div>


<p>And here's the result.</p>
<p><img alt="First word cloud of my past tweets" src="/images/wc_wordcloud1.jpeg" title="wordcloud"></p>
<p>Not too bad for a first pass, but I am unhappy about few things:
* the cloud could use some colours.
* I can see twitter user handle in this, which is not something i want in the final cloud, it probably happen during the removing of the punctuation in the corpus processing. I will need to fix that. But that also gave the idea to create a cloud with only the user handles to visualize, who i interacted the most with.
* It is very cluttered, I may need to reduce the number of words displayed, or increase the minimum limit. At the moment wordcloud tries to display every word appearing more than 10 times.
* That last command, generates many warning, which need to be investigated.</p>
<p>We load the data and the required packages.</p>
<div class="highlight"><pre><span></span><span class="n">tw</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">require</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>
<span class="nf">require</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
</pre></div>


<p>We can as previously create a corpus. In the package tm, the main data structure is an object collecting text documents.
More detail can be found there: <a href="http://cran.r-project.org/web/packages/tm/vignettes/tm.pdf">http://cran.r-project.org/web/packages/tm/vignettes/tm.pdf</a></p>
<p>I don't quite understand why, but you cannot directly input a data frame, but use a Source object - here via the appropriate command.
That last command (DataframeSource) takes a data frame on convert it into the appropriate object format.</p>
<p>Initially I tried to put tw$text directly, but this return a list not a data frame, hence the necessary coercion.</p>
<div class="highlight"><pre><span></span><span class="n">tw.corpus</span> <span class="o">&lt;-</span> <span class="nf">Corpus</span><span class="p">(</span><span class="nf">DataframeSource</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">tw</span><span class="o">$</span><span class="n">text</span><span class="p">)))</span>
</pre></div>


<p>Once the text are formatted in the right data structure for the package, we can avail the function of the tm package.</p>
<p>The most useful here for us, is tm_map, seen previously, I first remove the punctuation symbols with it, but a side effect is that all the users twitter handle lost their @ symbols. Here I want to remove the user handle all together.</p>
<p>My first idea was to use tm_map and removewords, meaning i had to create ( or detect ) a list of all twitter user handle.</p>
<div class="highlight"><pre><span></span><span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> 
  <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">removeWords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">grep</span><span class="p">(</span><span class="s">&quot;@[\\w\\d_]+&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="nf">strsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">),</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>


<p>But it seems way too complicated, and needed to deal with many exceptions around punctuation. So that not might be the best approach.
At that stage I decided to change my strategy. I should the processing before creating the corpus.</p>
<p>Clean up time, and reload.</p>
<div class="highlight"><pre><span></span><span class="nf">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="nf">ls</span><span class="p">())</span>
<span class="n">tw</span> <span class="o">=</span> <span class="nf">read.csv</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<p>At that stage tw$text is a list of string. I am going to merge those, remove the user handle ( actually store them in a separate list). Put all separate words into a long list</p>
<div class="highlight"><pre><span></span><span class="n">tw.txt</span> <span class="o">=</span> <span class="nf">unlist</span><span class="p">(</span><span class="n">tw</span><span class="o">$</span><span class="n">text</span><span class="p">)</span>
<span class="n">tw.words</span> <span class="o">=</span> <span class="nf">unlist</span><span class="p">(</span><span class="nf">strsplit</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">tw.txt</span><span class="p">),</span> <span class="n">split</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</pre></div>


<p>Extract user handles, using perl type regular expression since I am more familiar with those.</p>
<div class="highlight"><pre><span></span><span class="n">tw.usrhandle</span> <span class="o">=</span> <span class="nf">grep</span><span class="p">(</span><span class="s">&quot;@[\\w]+&quot;</span><span class="p">,</span> <span class="n">tw.words</span><span class="p">,</span> <span class="n">perl</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> 
</pre></div>


<p>A bit of cleanup is necessary removing extra punctuation, again the first line would remove the @, which i want to keep, after examining the handle, there is actually only 2 symbols to remove, this is done in the second line.</p>
<div class="highlight"><pre><span></span><span class="c1">#tw.usrhandle_1 = gsub(&quot;[[:punct:]]&quot;, &quot;&quot;, tw.usrhandle)</span>
<span class="n">tw.usrhandle</span> <span class="o">=</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&quot;[\\:\\)]&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">tw.usrhandle</span><span class="p">)</span>
</pre></div>


<p>We can build an barplot from that, to see the frequency of handle cited in the tweets.</p>
<div class="highlight"><pre><span></span><span class="nf">barplot</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">tw.usrhandle</span><span class="p">))</span>
</pre></div>


<p>For a better look, let's move to ggplot2:</p>
<div class="highlight"><pre><span></span><span class="nf">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="c1">#Create a data frame for easier use</span>
<span class="n">tw.usr.df</span> <span class="o">=</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">tw.usrhandle</span><span class="p">))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">tw.usr.df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tw.usrhandle</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Freq</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">Freq</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;#DD8888&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">.7</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.title.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">face</span><span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s">&quot;#990000&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">),</span>
  <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">90</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">))</span>
</pre></div>


<p><img alt="Barplot: Frequency of user handle found in the tweets." src="/images/wc_usr_hist.png" title="Barplot: Frequency of user handle found in the tweets."></p>
<p>We can have a look at how many, user have been cited in the tweets, here 859.</p>
<div class="highlight"><pre><span></span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">tw.usrhandle</span><span class="p">))</span>
</pre></div>


<p>Re-ordering, by frequency, before plotting</p>
<div class="highlight"><pre><span></span><span class="n">tw.usr.df</span> <span class="o">=</span> <span class="nf">transform</span><span class="p">(</span><span class="n">tw.usr.df</span><span class="p">,</span> <span class="n">tw.usrhandle</span> <span class="o">=</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">tw.usrhandle</span><span class="p">,</span> <span class="n">Freq</span><span class="p">))</span>
</pre></div>


<p>Or in a word cloud:</p>
<div class="highlight"><pre><span></span><span class="nf">wordcloud</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">tw.usr.df</span><span class="o">$</span><span class="n">tw.usrhandle</span><span class="p">,</span> 
          <span class="n">freq</span> <span class="o">=</span> <span class="n">tw.usr.df</span><span class="o">$</span><span class="n">Freq</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="nf">terrain.colors</span><span class="p">(</span><span class="m">20</span><span class="p">),</span>
          <span class="n">min.freq</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">max.words</span> <span class="o">=</span> <span class="kc">Inf</span><span class="p">,</span> <span class="n">random.order</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<p><img alt="User handle found in the tweets" src="/images/wc_usr0.png" title="User handle found in the tweets"></p>
<p>We can do the same with hashtag, but in this case let everything down to lower case.</p>
<div class="highlight"><pre><span></span><span class="n">tw.tag</span> <span class="o">=</span> <span class="nf">grep</span><span class="p">(</span><span class="s">&quot;#[\\w]+&quot;</span><span class="p">,</span> <span class="n">tw.words</span><span class="p">,</span> <span class="n">perl</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">tw.tag</span> <span class="o">=</span> <span class="nf">tolower</span><span class="p">(</span><span class="n">tw.tag</span><span class="p">)</span>
<span class="n">tw.tag.df</span> <span class="o">=</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">tw.tag</span><span class="p">))</span>

<span class="nf">par</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
 <span class="nf">wordcloud</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">tw.tag.df</span><span class="o">$</span><span class="n">tw.tag</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="n">tw.tag.df</span><span class="o">$</span><span class="n">Freq</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;orange&quot;</span><span class="p">),</span>
 <span class="n">min.freq</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">max.words</span> <span class="o">=</span> <span class="kc">Inf</span><span class="p">,</span> <span class="n">random.order</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
 <span class="nf">par</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="Hashtags used." src="/images/wc_hash.png" title="Hashtags used."></p>
<p>I used 1887 tags so far, which can be found with the first line of code, we can also plot an barplot of the frequency.</p>
<div class="highlight"><pre><span></span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">tw.tag</span><span class="p">))</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">tw.tag.df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tw.tag</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Freq</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">Freq</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;#DD8888&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">.7</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.title.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">face</span><span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s">&quot;#990000&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">),</span><span class="n">axis.text.x</span>  <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">90</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">))</span>
</pre></div>


<p>Let's go back to the words used</p>
<div class="highlight"><pre><span></span>  <span class="n">tw.words.wo.usr</span> <span class="o">=</span> <span class="n">tw.words</span>
</pre></div>


<p>Remove all usr handle</p>
<div class="highlight"><pre><span></span>  <span class="n">tw.words.wo.usr</span><span class="nf">[which</span><span class="p">(</span><span class="n">tw.words.wo.usr</span> <span class="o">%in%</span> <span class="n">tw.usrhandle</span><span class="p">)</span><span class="n">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</pre></div>


<p>Remove all hashtags </p>
<div class="highlight"><pre><span></span>  <span class="n">tw.words.wo.usr</span><span class="nf">[which</span><span class="p">(</span><span class="n">tw.words.wo.usr</span> <span class="o">%in%</span> <span class="n">tw.tag</span><span class="p">)</span><span class="n">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
<span class="nf">wordcloud</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">tw.words.wo.usr.df</span><span class="o">$</span><span class="n">tw.words.wo.usr</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="n">tw.words.wo.usr.df</span><span class="o">$</span><span class="n">Freq</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;orange&quot;</span><span class="p">),</span>
<span class="n">min.freq</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">max.words</span> <span class="o">=</span> <span class="kc">Inf</span><span class="p">,</span> <span class="n">random.order</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">par</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
</pre></div>


<p>But this generate a word cloud where we can see loads of english stopword like "the", "a" ... etc</p>
<p>This is where tm makes life easier. So time to go back to a corpus and the tm package.
Now we have a vector as input, so we use a different construct</p>
<div class="highlight"><pre><span></span><span class="n">tw.corpus</span> <span class="o">=</span> <span class="nf">Corpus</span><span class="p">(</span><span class="nf">VectorSource</span><span class="p">(</span><span class="n">tw.words.wo.usr</span><span class="p">))</span>
</pre></div>


<p>Here is can basically reuse the same code from last, I wrap it around a function, to make it easier to use in the future - should have started with that to be fair.</p>
<div class="highlight"><pre><span></span><span class="n">process_corpus</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">){</span>
 <span class="n">tw.corpus</span> <span class="o">=</span> <span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> <span class="n">removePunctuation</span><span class="p">)</span>
 <span class="n">tw.corpus</span> <span class="o">=</span> <span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> <span class="n">tolower</span><span class="p">)</span>
 <span class="n">tw.corpus</span> <span class="o">=</span> <span class="nf">tm_map</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">removeWords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">stopwords</span><span class="p">(</span><span class="s">&quot;english&quot;</span><span class="p">)))</span>
 <span class="n">tdm</span> <span class="o">=</span> <span class="nf">TermDocumentMatrix</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">)</span>
 <span class="n">m</span> <span class="o">=</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">tdm</span><span class="p">)</span>
</pre></div>


<p>And run the function</p>
<div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="nf">process_corpus</span><span class="p">(</span><span class="n">tw.corpus</span><span class="p">)</span>
</pre></div>


<p>Finally plotting the wordcloud</p>
<div class="highlight"><pre><span></span><span class="nf">wordcloud</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">d</span><span class="o">$</span><span class="n">word</span><span class="p">,</span><span class="n">freq</span> <span class="o">=</span> <span class="n">d</span><span class="o">$</span><span class="n">freq</span><span class="p">,</span>
 <span class="n">scale</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">.3</span><span class="p">),</span>
 <span class="n">min.freq</span><span class="o">=</span><span class="m">10</span><span class="p">,</span>
 <span class="n">max.words</span><span class="o">=</span><span class="kc">Inf</span><span class="p">,</span> <span class="n">random.order</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">rot.per</span><span class="o">=</span><span class="m">.15</span><span class="p">,</span> 
 <span class="n">vfont</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;sans serif&quot;</span><span class="p">,</span><span class="s">&quot;plain&quot;</span><span class="p">))</span>
</pre></div>


<p><img alt="Word cloud without user handle." src="/images/wc_wordcloud2.png" title="Word cloud without user handle"></p>
<h2>In summary, few lessons:</h2>
<p>it's worth to spend some time to process the data, to put it in a form usable. It can be a tedious process, but once you have the data in the right format, the function and package available in R makes your life really easy.</p>
<p>Write functions as much as you can, and as early as possible, instead of writing or copying te same lines of code over and over.</p>
<p>So I have produced nice graphs ( well I think so), but i haven't told any story, so it's a bit pointless.</p>
<p>A couple of links which were very useful in writing the R code:</p>
<p><a href="https://sites.google.com/site/miningtwitter/questions/talking-about/given-users">Mining twitter with R.</a></p>
<p><a href="https://sites.google.com/site/miningtwitter/basics/text-mining">Text mining with tm.</a></p>
    </div>
  </article>
  <hr>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      this.page.url = 'https://tofguerrier.github.io/tweet_word_cloud.html';
      this.page.identifier = 'tweet_word_cloud';
    };
    (function() {
      var d = document;
      var s = d.createElement('script');
      s.src = '//http-tofguerrier-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript class="text-muted">
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://tofguerrier.github.io/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://tofguerrier.github.io/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://tofguerrier.github.io/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://tofguerrier.github.io/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>